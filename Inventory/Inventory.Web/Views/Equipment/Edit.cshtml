@model Inventory.Web.Models.EquipmentVM

@{
    ViewBag.Title = "Редактирование оборудования";
}

<h2>Редактирование оборудования</h2>


@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    
    <div class="form-horizontal">
        <h4>@Model.EquipmentType.Name (@Model.InventNumber)</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.Id)

        <div class="form-group">
            @Html.LabelFor(model => model.EquipmentTypeId, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownList("EquipmentTypeId", null, "Тип оборудования", htmlAttributes: new { @class = "form-control", @required = "required" })
                @Html.ValidationMessageFor(model => model.EquipmentTypeId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.InventNumber, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.InventNumber, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.InventNumber, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.QRCode, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.QRCode, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.QRCode, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Price, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Price, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Price, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Supplier, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Supplier, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Supplier, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group" id="responsible-employees">
            <label for="search-input-value" class="col-md-2">Ответственный сотрудники</label>
            <div class="col-md-10" id="search-input">
                <div class="input-group">
                    <input type="text" class="form-control" id="search-input-value" placeholder="Поиск по имени и/или фамилии" />
                    <span class="input-group-btn">
                        <button class="btn btn-primary" type="button" onclick="searchEmployees()">Искать</button>
                        <button class="btn btn-danger" type="button" onclick="clearSearch()">Сбросить</button>
                    </span>
                </div>
                <span>Для редактирования записей добавленных сотрудников сохраните изменения.</span>
            </div>
        </div>

        <div id="found-employees-area"></div>

        <div class="row" id="attached-employees">
            <table class="table table-hover table-responsive table-striped" id="attached-employees-table">
                <caption>Список закрепленных сотрудников</caption>
                <thead>
                    <tr>
                        <th>Действие</th>
                        <th>ФИО</th>
                        <th>Кабинет</th>
                        <th>Должность</th>
                        <th>Отдел</th>
                        <th>Орган управления</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="attached-employees-tbody">
                    @if (ViewBag.OwnerHistory != null)
                    {
                        foreach (Inventory.BLL.DTO.OwnerInfoDTO owner in ViewBag.OwnerHistory)
                        {
                    <tr id="pinned-@owner.EmployeeId">
                        <td class="input-group-btn">
                            <input type="hidden" name="employeeId[]" value="@owner.EmployeeId" />
                            <button class="btn btn-danger" type="button" data-id="@owner.EmployeeId" onclick="detachEmployee(@owner.EmployeeId)">Убрать</button>
                            <a href="@Url.Action("EditRelation", "Equipment", new { equipmentId = Model.Id, employeeId = owner.EmployeeId })" class="btn btn-primary">Редактировать</a>
                        </td>
                        <td class="name">@owner.FullName</td>
                        <td class="room">@owner.Room</td>
                        <td class="position">@owner.Position</td>
                        <td class="department">@owner.Department</td>
                        <td class="administration">@owner.Administration</td>
                        <td>
                            <label><input type="radio" name="ownerId" value="@owner.EmployeeId"@Html.Raw(owner.IsActual ? " checked" : "") /> Текущий владелец</label>
                        </td>
                    </tr>
                        }
                    }
                </tbody>
            </table>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Сохранить" class="btn btn-default" />
            </div>
        </div>
    </div>
}

<div>
    @Html.ActionLink("Назад", "Index")
</div>

@section scripts {
<script src="~/Scripts/app.js"></script>
}
